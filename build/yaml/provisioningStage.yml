#
# Creates the shared resources needed for the Skills Functional Tests.
#

# "name" here defines the build number format. Build number is accessed via $(Build.BuildNumber)
name: $(Build.BuildId)
trigger: none
pr: none

variables:
  BuildConfiguration: 'Debug'
  BuildPlatform: 'any cpu'
  # AzureSubscription: define in Azure
  # KeyVaultObjectId: define in Azure
  # ResourceGroupName: define in Azure

pool:
  vmImage: 'windows-2019'

stages:
- stage: Provision
  jobs:
    - job: Create_Shared_Resources
      steps:
      - task: AzureCLI@2
        displayName: 'Create Resources'
        inputs:
          azureSubscription: $(AzureSubscription)
          scriptType: ps
          scriptLocation: inlineScript
          inlineScript: 'az deployment group create --name bffnDeployment-"$(Build.BuildId)" --resource-group "$(ResourceGroupName)" --template-file build/templates/template-shared-resources.json --parameters build/templates/parameters-shared-resources.json --parameters objectId="$(KeyVaultObjectId)"'
